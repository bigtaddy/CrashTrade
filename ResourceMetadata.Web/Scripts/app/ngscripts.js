window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,r){r.defaults.useXDomain=!0,delete r.defaults.headers.common["X-Requested-With"],t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Manufactures",{templateUrl:"/Scripts/app/views/manufactures/Listing.html",controller:"ManufacturesCtrl"}).when("/Manufactures/Add",{templateUrl:"/Scripts/app/views/manufactures/Add.html",controller:"ManufactureCtrl"}).when("/Manufactures/Edit/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Edit.html",controller:"ManufactureCtrl"}).when("/Manufactures/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Details.html",controller:"ManufactureCtrl"}).when("/CarModels",{templateUrl:"/Scripts/app/views/carModels/Listing.html",controller:"CarModelsCtrl"}).when("/CarModels/Add",{templateUrl:"/Scripts/app/views/carModels/Add.html",controller:"CarModelCtrl"}).when("/CarModels/Edit/:carModelId",{templateUrl:"/Scripts/app/views/carModels/Edit.html",controller:"CarModelCtrl"}).when("/CarModels/:carModelId",{templateUrl:"/Scripts/app/views/carModels/Details.html",controller:"CarModelCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),r.interceptors.push("authorizationInterceptor"),r.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]);
window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,r){r.defaults.useXDomain=!0,delete r.defaults.headers.common["X-Requested-With"],t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Manufactures",{templateUrl:"/Scripts/app/views/manufactures/Listing.html",controller:"ManufacturesCtrl"}).when("/Manufactures/Add",{templateUrl:"/Scripts/app/views/manufactures/Add.html",controller:"ManufactureCtrl"}).when("/Manufactures/Edit/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Edit.html",controller:"ManufactureCtrl"}).when("/Manufactures/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Details.html",controller:"ManufactureCtrl"}).when("/CarModels",{templateUrl:"/Scripts/app/views/carModels/Listing.html",controller:"CarModelsCtrl"}).when("/CarModels/Add",{templateUrl:"/Scripts/app/views/carModels/Add.html",controller:"CarModelCtrl"}).when("/CarModels/Edit/:carModelId",{templateUrl:"/Scripts/app/views/carModels/Edit.html",controller:"CarModelCtrl"}).when("/CarModels/:carModelId",{templateUrl:"/Scripts/app/views/carModels/Details.html",controller:"CarModelCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),r.interceptors.push("authorizationInterceptor"),r.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]),window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,r){r.defaults.useXDomain=!0,delete r.defaults.headers.common["X-Requested-With"],t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Manufactures",{templateUrl:"/Scripts/app/views/manufactures/Listing.html",controller:"ManufacturesCtrl"}).when("/Manufactures/Add",{templateUrl:"/Scripts/app/views/manufactures/Add.html",controller:"ManufactureCtrl"}).when("/Manufactures/Edit/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Edit.html",controller:"ManufactureCtrl"}).when("/Manufactures/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Details.html",controller:"ManufactureCtrl"}).when("/CarModels",{templateUrl:"/Scripts/app/views/carModels/Listing.html",controller:"CarModelsCtrl"}).when("/CarModels/Add",{templateUrl:"/Scripts/app/views/carModels/Add.html",controller:"CarModelCtrl"}).when("/CarModels/Edit/:carModelId",{templateUrl:"/Scripts/app/views/carModels/Edit.html",controller:"CarModelCtrl"}).when("/CarModels/:carModelId",{templateUrl:"/Scripts/app/views/carModels/Details.html",controller:"CarModelCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),r.interceptors.push("authorizationInterceptor"),r.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]),window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,r){r.defaults.useXDomain=!0,delete r.defaults.headers.common["X-Requested-With"],t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Manufactures",{templateUrl:"/Scripts/app/views/manufactures/Listing.html",controller:"ManufacturesCtrl"}).when("/Manufactures/Add",{templateUrl:"/Scripts/app/views/manufactures/Add.html",controller:"ManufactureCtrl"}).when("/Manufactures/Edit/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Edit.html",controller:"ManufactureCtrl"}).when("/Manufactures/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Details.html",controller:"ManufactureCtrl"}).when("/CarModels",{templateUrl:"/Scripts/app/views/carModels/Listing.html",controller:"CarModelsCtrl"}).when("/CarModels/Add",{templateUrl:"/Scripts/app/views/carModels/Add.html",controller:"CarModelCtrl"}).when("/CarModels/Edit/:carModelId",{templateUrl:"/Scripts/app/views/carModels/Edit.html",controller:"CarModelCtrl"}).when("/CarModels/:carModelId",{templateUrl:"/Scripts/app/views/carModels/Details.html",controller:"CarModelCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),r.interceptors.push("authorizationInterceptor"),r.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]),window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,r){r.defaults.useXDomain=!0,delete r.defaults.headers.common["X-Requested-With"],r.defaults.useXDomain=!0,t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Manufactures",{templateUrl:"/Scripts/app/views/manufactures/Manufactures-ng-table.html",controller:"ManufacturesCtrl"}).when("/Manufactures/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Details.html",controller:"ManufactureCtrl"}).when("/Manufactures/Add",{templateUrl:"/Scripts/app/views/manufactures/Add.html",controller:"ManufactureCtrl"}).when("/Manufactures/Edit/:manufactureId",{templateUrl:"/Scripts/app/views/manufactures/Edit.html",controller:"ManufactureEditCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),r.interceptors.push("authorizationInterceptor"),r.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]),window.app=angular.module("resourceManagerApp",["ui.select2","ngTable","ngRoute","ngResource","ngAnimate","custom-utilities"]),app.config(["$routeProvider","$locationProvider","$httpProvider","$provide",function(e,t,r){r.defaults.useXDomain=!0,delete r.defaults.headers.common["X-Requested-With"],r.defaults.useXDomain=!0,t.html5Mode(!0),e.when("/Login",{templateUrl:"/Scripts/app/views/shared/Login.html"}).when("/Register",{templateUrl:"/Scripts/app/views/shared/Register.html"}).when("/Locations",{templateUrl:"/Scripts/app/views/locations/Locations.html",controller:"LocationsCtrl"}).when("/About",{templateUrl:"/Scripts/app/views/about/About.html"}).when("/Locations/Add",{templateUrl:"/Scripts/app/views/locations/Add.html",controller:"LocationCtrl"}).when("/Locations/Edit/:locationId",{templateUrl:"/Scripts/app/views/locations/Edit.html",controller:"LocationCtrl"}).when("/Resources",{templateUrl:"/Scripts/app/views/resources/Resources-ng-table.html",controller:"ResourcesCtrl"}).when("/Resources/Add",{templateUrl:"/Scripts/app/views/resources/Add.html",controller:"ResourceCtrl"}).when("/Resources/Edit/:resourceId",{templateUrl:"/Scripts/app/views/resources/Edit.html",controller:"ResourceEditCtrl"}).when("/Resources/:resourceId",{templateUrl:"/Scripts/app/views/resources/Details.html",controller:"ResourceCtrl"}).when("/Activities/Add",{templateUrl:"/Scripts/app/views/activities/Add.html",controller:"ActivityAddCtrl"}).when("/Home",{templateUrl:"/Scripts/app/views/home/Home.html",controller:"HomeCtrl"}).when("/Error",{templateUrl:"/Scripts/app/views/shared/Error.html"}).otherwise({redirectTo:"/Login"}),r.interceptors.push("authorizationInterceptor"),r.interceptors.push("httpInterceptor")}]).factory("userProfileSvc",function(){return{}}),window.utilities=angular.module("custom-utilities",[]),app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(e,t,r){return{responseError:function(o){switch(o.status){case 401:e.$broadcast("logOff"),r.url("/Login");break;case 403:r.url("/Login")}return t.reject(o)}}}]),app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(e,t,r,o){function n(){r.locationId>0&&(e.location=o.getLocation(r.locationId))}e.addLocation=function(e){o.addLocation(e).$promise.then(function(){t.url("/Locations")})},e.editLocation=function(e){o.editLocation(e).$promise.then(function(){t.url("/Locations")})},n()}]),app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getLocations().$promise.then(function(t){e.resolve(t)})}}),e.deleteLocation=function(t){r.deleteLocation(t).$promise.then(function(){e.tableParams.reload()})}}]),app.service("activitySvc",["$resource","serviceHelperSvc",function(e,t){var r=t.ResourceActivity,o=function(e){return r.save({resourceId:e.ResourceId},e).$promise},n=function(e){return r["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},c=function(e){return r.query({resourceId:e})};return{addActivity:o,deleteActivity:n,getActivites:c}}]),utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,t){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},t.on("click",function(){angular.element("#"+e.id).modal("show")})}}}]),utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,r,o){t.datepicker({maxDate:0,onSelect:function(t){o.$setViewValue(t),e.$apply(),o.$setValidity("invalid",!1)}}),t.on("keypress",function(){return!1})}}}),utilities.directive("cstExternalUrl",function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(r,o,n){var c=n.cstExternalUrl;c&&t.test(c)&&(r.isWebUrl=!0,o.css("text-decoration","underline"),o.css("cursor","pointer")),o.on("click",function(){r.isWebUrl&&e.open(c)})}}}),app.directive("cstDelete",function(){return{replace:!0,link:function(e,t){console.log(t),t.on("click",function(){return confirm("Delete item?")})}}}),utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(e,t,r,o){function n(e){e.removeClass("hide"),e.addClass("show")}function c(e){e.removeClass("show"),e.addClass("hide")}var i=/\.html$|\.html\?/i,a={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(s,u){var l=[];r.request=function(e){return console.log("request: "+e.url),l.push({}),1==l.length&&n(u),e||t.when(e)},r.response=function(r){return i.test(r.config.url)&&(a[r.config.url]||(r.data=o.processTemplate(r),a[r.config.url]=!0)),console.log("response: "+r.config.url),l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),r||t.when(r)},r.responseError=function(r){return l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),t.reject(r)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(e,t){var r=/data-(keep|omit)/;return{processTemplate:function(o){var n=o.data,c=$("<div>").append(n);return r.test(n)&&c.find('[data-omit="'+t.role+'"]').each(function(){var e=$(this);e.remove()}),n=c.html(),e.put(o.config.url,n),n}}}]),utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(e,t,r){t.on("click",function(){var e="#"+r.cstModal;$(e).modal("show")})}}}),app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(e,t){var r=t.find("a");r.on("click",function(){r.removeClass("active"),$(this).addClass("active")}),e.$on("logOff",function(){e.isAuthenticated=!1}),e.$on("logOn",function(){e.isAuthenticated=!0})}}}),app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(e,t,r){var o=t.AuthorizationToken,n=t.Account,c=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t+=r+"="+e[r]+"&");return t.slice(0,t.length-1)};return{login:function(t){var n={username:t.Email,password:t.Password,grant_type:"password"};return o.requestToken(c(n),function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,r.role=t.role})},registerUser:function(e){var t=n.register(e);return t},logOffUser:function(){e.defaults.headers.common.Authorization=null}}}]),app.factory("serviceHelperSvc",["$http","$resource",function(e,t){var r=config.apiurl,o=function(e){return r+e};return{AuthorizationToken:t(o("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:t(o("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Resource:t(o("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:o("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:t(o("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:t(o("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]),app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,t,r,o,n){function c(){t.resourceId>0?e.resource=o.getResource(t.resourceId):e.locations=n.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){o.addResource(e).$promise.then(function(){r.url("/Resources")})},c()}]),app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,t,r,o){function n(){for(var e=[],t=1;10>=t;t++)e.push({priority:t});return e}function c(){o.createResourceEditFormModel(r.resourceId).then(function(t){e.resource=t[0],e.locations=t[1],e.priorities=n()})}c(),e.editResource=function(e){o.editResource(e).$promise.then(function(){t.url("/Resources")})}}]),app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,t,r){var o=function(e){var t,r,o=e.sorting();if(o)for(var n in o){t=n,r=o[n];break}return{page:e.page(),count:e.count(),sortField:t,sortOrder:r}};e.tableParams=new r({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,r){t.getPagedResources(o(r)).$promise.then(function(t){r.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(r){t.deleteResource(r).$promise.then(function(){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(e,t,r){e.deleteActivity=function(t){r.deleteActivity(t).then(function(){e.activities=r.getActivites(t.ResourceId)})}}]),app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(e,t,r,o){e.activity={ResourceId:r.resourceId},e.addActivity=function(e){o.addActivity(e).then(function(e){t.url("/Resources/"+e.ResourceId)})}}]),app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,r,o){var n=o.Resource,c=function(){return n.query({count:5})},i=function(){return n.query()},a=function(e){return n["delete"]({resourceId:e})},s=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({resourceId:e})},d=function(e){var o=t.all([this.getResource(e).$promise,r.getLocations().$promise]);return o},p=function(e){return n.getPagedItems(e)};return{getTopFiveResources:c,getResources:i,deleteResource:a,addResource:s,editResource:u,getResource:l,createResourceEditFormModel:d,getPagedResources:p}}]),app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}}),app.controller("HomeCtrl",["$scope","resourceSvc",function(e,t){function r(){o()}function o(){e.resources=t.getTopFiveResources()}r()}]),app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,t,r){e.login=function(o){e.errorMessage="",r.login(o).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})["catch"](function(t){404==t.status&&(e.errorMessage=t.data),e.errorMessage=400===t.status?"Invalid Email/Password":"An error occured while performing this action. Please try after some time."})},e.register=function(o){return o.password!==o.confirmPassword?void(e.errorMessage="Passwords do not match"):(e.errorMessage="",void r.registerUser(o).$promise.then(function(){return r.login({Email:o.email,Password:o.password}).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})})["catch"](function(t){e.errorMessage=400===t.status?"Email already exists.":"An error occured while performing this action. Please try after some time."}))},e.logOff=function(){r.logOffUser(),e.$emit("logOff"),t.url("/Login")}}]),app.factory("locationSvc",["$resource","serviceHelperSvc",function(e,t){var r=t.Location,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({locationId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({locationId:e})};return{addLocation:o,editLocation:n,getLocation:c,getLocations:i,deleteLocation:a}}]),app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(e,t,r){return{responseError:function(o){switch(o.status){case 401:e.$broadcast("logOff"),r.url("/Login");break;case 403:r.url("/Login")}return t.reject(o)}}}]),utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,t){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},t.on("click",function(){angular.element("#"+e.id).modal("show")})}}}]),utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,r,o){t.datepicker({maxDate:0,onSelect:function(t){o.$setViewValue(t),e.$apply(),o.$setValidity("invalid",!1)}}),t.on("keypress",function(){return!1})}}}),utilities.directive("cstExternalUrl",function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(r,o,n){var c=n.cstExternalUrl;c&&t.test(c)&&(r.isWebUrl=!0,o.css("text-decoration","underline"),o.css("cursor","pointer")),o.on("click",function(){r.isWebUrl&&e.open(c)})}}}),app.directive("cstDelete",function(){return{replace:!0,link:function(e,t){console.log(t),t.on("click",function(){return confirm("Delete item?")})}}}),utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(e,t,r,o){function n(e){e.removeClass("hide"),e.addClass("show")}function c(e){e.removeClass("show"),e.addClass("hide")}var i=/\.html$|\.html\?/i,a={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(s,u){var l=[];r.request=function(e){return console.log("request: "+e.url),l.push({}),1==l.length&&n(u),e||t.when(e)},r.response=function(r){return i.test(r.config.url)&&(a[r.config.url]||(r.data=o.processTemplate(r),a[r.config.url]=!0)),console.log("response: "+r.config.url),l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),r||t.when(r)},r.responseError=function(r){return l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),t.reject(r)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(e,t){var r=/data-(keep|omit)/;return{processTemplate:function(o){var n=o.data,c=$("<div>").append(n);return r.test(n)&&c.find('[data-omit="'+t.role+'"]').each(function(){var e=$(this);e.remove()}),n=c.html(),e.put(o.config.url,n),n}}}]),utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(e,t,r){t.on("click",function(){var e="#"+r.cstModal;$(e).modal("show")})}}}),app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(e,t){var r=t.find("a");r.on("click",function(){r.removeClass("active"),$(this).addClass("active")}),e.$on("logOff",function(){e.isAuthenticated=!1}),e.$on("logOn",function(){e.isAuthenticated=!0})}}}),app.controller("HomeCtrl",["$scope","resourceSvc",function(e,t){function r(){o()}function o(){e.resources=t.getTopFiveResources()}r()}]),app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(e,t,r){e.deleteActivity=function(t){r.deleteActivity(t).then(function(){e.activities=r.getActivites(t.ResourceId)})}}]),app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(e,t,r,o){e.activity={ResourceId:r.resourceId},e.addActivity=function(e){o.addActivity(e).then(function(e){t.url("/Resources/"+e.ResourceId)})}}]),app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}}),app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,t,r){e.login=function(o){e.errorMessage="",r.login(o).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})["catch"](function(t){404==t.status&&(e.errorMessage=t.data),e.errorMessage=400===t.status?"Invalid Email/Password":"An error occured while performing this action. Please try after some time."})},e.register=function(o){return o.password!==o.confirmPassword?void(e.errorMessage="Passwords do not match"):(e.errorMessage="",void r.registerUser(o).$promise.then(function(){return r.login({Email:o.email,Password:o.password}).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})})["catch"](function(t){e.errorMessage=400===t.status?"Email already exists.":"An error occured while performing this action. Please try after some time."}))},e.logOff=function(){r.logOffUser(),e.$emit("logOff"),t.url("/Login")}}]),app.controller("ManufactureCtrl",["$scope","$location","$routeParams","manufactureService",function(e,t,r,o){function n(){r.manufactureId>0&&(e.manufacture=o.getManufacture(r.manufactureId))}e.addLocation=function(e){o.addManufacture(e).$promise.then(function(){t.url("/Locations")})},e.editLocation=function(e){o.editManufacture(e).$promise.then(function(){t.url("/Locations")})},n()}]),app.controller("ManufacturesCtrl",["$scope","ngTableParams","manufactureService",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getManufactures().$promise.then(function(t){e.resolve(t)})}}),e.deleteManufacture=function(t){r.deleteManufacture(t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(e,t,r,o){function n(){r.locationId>0&&(e.location=o.getLocation(r.locationId))}e.addLocation=function(e){o.addLocation(e).$promise.then(function(){t.url("/Locations")})},e.editLocation=function(e){o.editLocation(e).$promise.then(function(){t.url("/Locations")})},n()}]),app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getLocations().$promise.then(function(t){e.resolve(t)})}}),e.deleteLocation=function(t){r.deleteLocation(t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,t,r,o,n){function c(){t.resourceId>0?e.resource=o.getResource(t.resourceId):e.locations=n.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){o.addResource(e).$promise.then(function(){r.url("/Resources")})},c()}]),app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,t,r,o){function n(){for(var e=[],t=1;10>=t;t++)e.push({priority:t});return e}function c(){o.createResourceEditFormModel(r.resourceId).then(function(t){e.resource=t[0],e.locations=t[1],e.priorities=n()})}c(),e.editResource=function(e){o.editResource(e).$promise.then(function(){t.url("/Resources")})}}]),app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,t,r){var o=function(e){var t,r,o=e.sorting();if(o)for(var n in o){t=n,r=o[n];break}return{page:e.page(),count:e.count(),sortField:t,sortOrder:r}};e.tableParams=new r({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,r){t.getPagedResources(o(r)).$promise.then(function(t){r.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(r){t.deleteResource(r).$promise.then(function(){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.factory("manufactureService",["$resource","serviceHelperSvc",function(e,t){var r=t.Manufacture,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({manufactureId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({manufactureId:e})};return{addManufacture:o,editManufacture:n,getManufacture:c,getManufactures:i,deleteManufacture:a}}]),app.service("activitySvc",["$resource","serviceHelperSvc",function(e,t){var r=t.ResourceActivity,o=function(e){return r.save({resourceId:e.ResourceId},e).$promise},n=function(e){return r["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},c=function(e){return r.query({resourceId:e})};return{addActivity:o,deleteActivity:n,getActivites:c}}]),app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,r,o){var n=o.Resource,c=function(){return n.query({count:5})},i=function(){return n.query()},a=function(e){return n["delete"]({resourceId:e})},s=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({resourceId:e})},d=function(e){var o=t.all([this.getResource(e).$promise,r.getLocations().$promise]);return o},p=function(e){return n.getPagedItems(e)};return{getTopFiveResources:c,getResources:i,deleteResource:a,addResource:s,editResource:u,getResource:l,createResourceEditFormModel:d,getPagedResources:p}}]),app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(e,t,r){var o=t.AuthorizationToken,n=t.Account,c=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t+=r+"="+e[r]+"&");return t.slice(0,t.length-1)};return{login:function(t){var n={username:t.Email,password:t.Password,grant_type:"password"};return o.requestToken(c(n),function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,r.role=t.role})},registerUser:function(e){var t=n.register(e);return t},logOffUser:function(){e.defaults.headers.common.Authorization=null}}}]),app.factory("serviceHelperSvc",["$http","$resource",function(e,t){var r=config.apiurl,o=function(e){return r+e};return{AuthorizationToken:t(o("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:t(o("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Resource:t(o("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:o("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:t(o("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),Manufacture:t(o("api/Manufactures/:manufactureId"),{manufactureId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:t(o("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}
}]),app.factory("locationSvc",["$resource","serviceHelperSvc",function(e,t){var r=t.Location,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({locationId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({locationId:e})};return{addLocation:o,editLocation:n,getLocation:c,getLocations:i,deleteLocation:a}}]),app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(e,t,r){return{responseError:function(o){switch(o.status){case 401:e.$broadcast("logOff"),r.url("/Login");break;case 403:r.url("/Login")}return t.reject(o)}}}]),app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(e,t,r){e.deleteActivity=function(t){r.deleteActivity(t).then(function(){e.activities=r.getActivites(t.ResourceId)})}}]),app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(e,t,r,o){e.activity={ResourceId:r.resourceId},e.addActivity=function(e){o.addActivity(e).then(function(e){t.url("/Resources/"+e.ResourceId)})}}]),app.controller("CarModelCtrl",["$scope","$location","$routeParams","carModelService",function(e,t,r,o){function n(){r.carModelId>0&&(e.carModel=o.getById(r.carModelId))}e.addCarModel=function(e){o.add(e).$promise.then(function(){t.url("/CarModels")})},e.editCarModel=function(e){o.edit(e).$promise.then(function(){t.url("/CarModels")})},n()}]),app.controller("CarModelsCtrl",["$scope","ngTableParams","carModelService",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getAll().$promise.then(function(t){e.resolve(t)})}}),e.deleteCarModel=function(t){r["delete"](t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("HomeCtrl",["$scope","resourceSvc",function(e,t){function r(){o()}function o(){e.resources=t.getTopFiveResources()}r()}]),app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(e,t,r,o){function n(){r.locationId>0&&(e.location=o.getLocation(r.locationId))}e.addLocation=function(e){o.addLocation(e).$promise.then(function(){t.url("/Locations")})},e.editLocation=function(e){o.editLocation(e).$promise.then(function(){t.url("/Locations")})},n()}]),app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getLocations().$promise.then(function(t){e.resolve(t)})}}),e.deleteLocation=function(t){r.deleteLocation(t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,t,r,o,n){function c(){t.resourceId>0?e.resource=o.getResource(t.resourceId):e.locations=n.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){o.addResource(e).$promise.then(function(){r.url("/Resources")})},c()}]),app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,t,r,o){function n(){for(var e=[],t=1;10>=t;t++)e.push({priority:t});return e}function c(){o.createResourceEditFormModel(r.resourceId).then(function(t){e.resource=t[0],e.locations=t[1],e.priorities=n()})}c(),e.editResource=function(e){o.editResource(e).$promise.then(function(){t.url("/Resources")})}}]),app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,t,r){var o=function(e){var t,r,o=e.sorting();if(o)for(var n in o){t=n,r=o[n];break}return{page:e.page(),count:e.count(),sortField:t,sortOrder:r}};e.tableParams=new r({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,r){t.getPagedResources(o(r)).$promise.then(function(t){r.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(r){t.deleteResource(r).$promise.then(function(){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}}),app.service("activitySvc",["$resource","serviceHelperSvc",function(e,t){var r=t.ResourceActivity,o=function(e){return r.save({resourceId:e.ResourceId},e).$promise},n=function(e){return r["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},c=function(e){return r.query({resourceId:e})};return{addActivity:o,deleteActivity:n,getActivites:c}}]),utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,t){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},t.on("click",function(){angular.element("#"+e.id).modal("show")})}}}]),utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,r,o){t.datepicker({maxDate:0,onSelect:function(t){o.$setViewValue(t),e.$apply(),o.$setValidity("invalid",!1)}}),t.on("keypress",function(){return!1})}}}),utilities.directive("cstExternalUrl",function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(r,o,n){var c=n.cstExternalUrl;c&&t.test(c)&&(r.isWebUrl=!0,o.css("text-decoration","underline"),o.css("cursor","pointer")),o.on("click",function(){r.isWebUrl&&e.open(c)})}}}),app.directive("cstDelete",function(){return{replace:!0,link:function(e,t){console.log(t),t.on("click",function(){return confirm("Delete item?")})}}}),utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(e,t,r,o){function n(e){e.removeClass("hide"),e.addClass("show")}function c(e){e.removeClass("show"),e.addClass("hide")}var i=/\.html$|\.html\?/i,a={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(s,u){var l=[];r.request=function(e){return console.log("request: "+e.url),l.push({}),1==l.length&&n(u),e||t.when(e)},r.response=function(r){return i.test(r.config.url)&&(a[r.config.url]||(r.data=o.processTemplate(r),a[r.config.url]=!0)),console.log("response: "+r.config.url),l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),r||t.when(r)},r.responseError=function(r){return l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),t.reject(r)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(e,t){var r=/data-(keep|omit)/;return{processTemplate:function(o){var n=o.data,c=$("<div>").append(n);return r.test(n)&&c.find('[data-omit="'+t.role+'"]').each(function(){var e=$(this);e.remove()}),n=c.html(),e.put(o.config.url,n),n}}}]),utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(e,t,r){t.on("click",function(){var e="#"+r.cstModal;$(e).modal("show")})}}}),app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(e,t){var r=t.find("a");r.on("click",function(){r.removeClass("active"),$(this).addClass("active")}),e.$on("logOff",function(){e.isAuthenticated=!1}),e.$on("logOn",function(){e.isAuthenticated=!0})}}}),app.factory("carModelService",["$resource","serviceHelperSvc",function(e,t){var r=t.CarModel,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({carModelId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({carModelId:e})};return{add:o,edit:n,getById:c,getAll:i,deleteById:a}}]),app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(e,t,r){var o=t.AuthorizationToken,n=t.Account,c=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t+=r+"="+e[r]+"&");return t.slice(0,t.length-1)};return{login:function(t){var n={username:t.Email,password:t.Password,grant_type:"password"};return o.requestToken(c(n),function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,r.role=t.role})},registerUser:function(e){var t=n.register(e);return t},logOffUser:function(){e.defaults.headers.common.Authorization=null}}}]),app.factory("serviceHelperSvc",["$http","$resource",function(e,t){var r=config.apiurl,o=function(e){return r+e};return{AuthorizationToken:t(o("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:t(o("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Resource:t(o("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:o("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:t(o("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),Manufacture:t(o("api/Manufactures/:manufactureId"),{manufactureId:"@Id"},{update:{method:"PUT"}}),CarModel:t(o("api/CarModels/:carModelId"),{carModelId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:t(o("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]),app.factory("locationSvc",["$resource","serviceHelperSvc",function(e,t){var r=t.Location,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({locationId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({locationId:e})};return{addLocation:o,editLocation:n,getLocation:c,getLocations:i,deleteLocation:a}}]),app.factory("manufactureService",["$resource","serviceHelperSvc",function(e,t){var r=t.Manufacture,o=function(e){var t=r.update(e);return t},n=function(e){return r.get({manufactureId:e})},c=function(){return r.query()},i=function(e){return r["delete"]({manufactureId:e})};return{add:add,edit:o,getById:n,getAll:c,deleteById:i}}]),app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,r,o){var n=o.Resource,c=function(){return n.query({count:5})},i=function(){return n.query()},a=function(e){return n["delete"]({resourceId:e})},s=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({resourceId:e})},d=function(e){var o=t.all([this.getResource(e).$promise,r.getLocations().$promise]);return o},p=function(e){return n.getPagedItems(e)};return{getTopFiveResources:c,getResources:i,deleteResource:a,addResource:s,editResource:u,getResource:l,createResourceEditFormModel:d,getPagedResources:p}}]),app.controller("ManufactureCtrl",["$scope","$location","$routeParams","manufactureService",function(e,t,r,o){function n(){r.manufactureId>0&&(e.manufacture=o.getById(r.manufactureId))}e.addManufacture=function(e){o.addManufacture(e).$promise.then(function(){t.url("/Manufactures")})},e.editManufacture=function(e){o.edit(e).$promise.then(function(){t.url("/Manufactures")})},n()}]),app.controller("ManufacturesCtrl",["$scope","ngTableParams","manufactureService",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getAll().$promise.then(function(t){e.resolve(t)})}}),e.deleteManufacture=function(t){r.deleteById(t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,t,r){e.login=function(o){e.errorMessage="",r.login(o).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})["catch"](function(t){404==t.status&&(e.errorMessage=t.data),e.errorMessage=400===t.status?"Неверный Email/Пароль":"An error occured while performing this action. Please try after some time."})},e.register=function(o){return o.password!==o.confirmPassword?void(e.errorMessage="Пароли не совпадают"):(e.errorMessage="",void r.registerUser(o).$promise.then(function(){return r.login({Email:o.email,Password:o.password}).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})})["catch"](function(t){e.errorMessage=400===t.status?"Такой email уже существует.":"An error occured while performing this action. Please try after some time."}))},e.logOff=function(){r.logOffUser(),e.$emit("logOff"),t.url("/Login")}}]),app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(e,t,r){return{responseError:function(o){switch(o.status){case 401:e.$broadcast("logOff"),r.url("/Login");break;case 403:r.url("/Login")}return t.reject(o)}}}]),app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}}),app.service("activitySvc",["$resource","serviceHelperSvc",function(e,t){var r=t.ResourceActivity,o=function(e){return r.save({resourceId:e.ResourceId},e).$promise},n=function(e){return r["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},c=function(e){return r.query({resourceId:e})};return{addActivity:o,deleteActivity:n,getActivites:c}}]),app.factory("carModelService",["$resource","serviceHelperSvc",function(e,t){var r=t.CarModel,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({carModelId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({carModelId:e})};return{add:o,edit:n,getById:c,getAll:i,deleteById:a}}]),app.factory("locationSvc",["$resource","serviceHelperSvc",function(e,t){var r=t.Location,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({locationId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({locationId:e})};return{addLocation:o,editLocation:n,getLocation:c,getLocations:i,deleteLocation:a}}]),app.factory("manufactureService",["$resource","serviceHelperSvc",function(e,t){var r=t.Manufacture,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({manufactureId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({manufactureId:e})};return{add:o,edit:n,getById:c,getAll:i,deleteById:a}}]),app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,r,o){var n=o.Resource,c=function(){return n.query({count:5})},i=function(){return n.query()},a=function(e){return n["delete"]({resourceId:e})},s=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({resourceId:e})},d=function(e){var o=t.all([this.getResource(e).$promise,r.getLocations().$promise]);return o},p=function(e){return n.getPagedItems(e)};return{getTopFiveResources:c,getResources:i,deleteResource:a,addResource:s,editResource:u,getResource:l,createResourceEditFormModel:d,getPagedResources:p}}]),app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(e,t,r){var o=t.AuthorizationToken,n=t.Account,c=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t+=r+"="+e[r]+"&");return t.slice(0,t.length-1)};return{login:function(t){var n={username:t.Email,password:t.Password,grant_type:"password"};return o.requestToken(c(n),function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,r.role=t.role})},registerUser:function(e){var t=n.register(e);return t},logOffUser:function(){e.defaults.headers.common.Authorization=null}}}]),app.factory("serviceHelperSvc",["$http","$resource",function(e,t){var r=config.apiurl,o=function(e){return r+e};return{AuthorizationToken:t(o("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:t(o("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Resource:t(o("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:o("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:t(o("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),Manufacture:t(o("api/Manufactures/:manufactureId"),{manufactureId:"@Id"},{update:{method:"PUT"}}),CarModel:t(o("api/CarModels/:carModelId"),{carModelId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:t(o("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]),app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(e,t,r){e.deleteActivity=function(t){r.deleteActivity(t).then(function(){e.activities=r.getActivites(t.ResourceId)})}}]),app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(e,t,r,o){e.activity={ResourceId:r.resourceId},e.addActivity=function(e){o.addActivity(e).then(function(e){t.url("/Resources/"+e.ResourceId)})}}]),app.controller("CarModelCtrl",["$scope","$location","$routeParams","carModelService",function(e,t,r,o){function n(){r.carModelId>0&&(e.carModel=o.getById(r.carModelId))}e.addCarModel=function(e){o.add(e).$promise.then(function(){t.url("/CarModels")})},e.editCarModel=function(e){o.edit(e).$promise.then(function(){t.url("/CarModels")})},n()}]),app.controller("CarModelsCtrl",["$scope","ngTableParams","carModelService",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getAll().$promise.then(function(t){e.resolve(t)})}}),e.deleteCarModel=function(t){r["delete"](t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(e,t,r,o){function n(){r.locationId>0&&(e.location=o.getLocation(r.locationId))}e.addLocation=function(e){o.addLocation(e).$promise.then(function(){t.url("/Locations")})},e.editLocation=function(e){o.editLocation(e).$promise.then(function(){t.url("/Locations")})},n()}]),app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getLocations().$promise.then(function(t){e.resolve(t)})}}),e.deleteLocation=function(t){r.deleteLocation(t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("ManufactureCtrl",["$scope","$location","$routeParams","manufactureService",function(e,t,r,o){function n(){r.manufactureId>0&&(e.manufacture=o.getById(r.manufactureId))}e.addManufacture=function(e){o.add(e).$promise.then(function(){t.url("/Manufactures")})},e.editManufacture=function(e){o.edit(e).$promise.then(function(){t.url("/Manufactures")})},n()}]),app.controller("ManufacturesCtrl",["$scope","ngTableParams","manufactureService",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getAll().$promise.then(function(t){e.resolve(t)})}}),e.deleteManufacture=function(t){r.deleteById(t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,t,r,o,n){function c(){t.resourceId>0?e.resource=o.getResource(t.resourceId):e.locations=n.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){o.addResource(e).$promise.then(function(){r.url("/Resources")})},c()}]),app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,t,r,o){function n(){for(var e=[],t=1;10>=t;t++)e.push({priority:t});return e}function c(){o.createResourceEditFormModel(r.resourceId).then(function(t){e.resource=t[0],e.locations=t[1],e.priorities=n()})}c(),e.editResource=function(e){o.editResource(e).$promise.then(function(){t.url("/Resources")})}}]),app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,t,r){var o=function(e){var t,r,o=e.sorting();if(o)for(var n in o){t=n,r=o[n];break}return{page:e.page(),count:e.count(),sortField:t,sortOrder:r}};e.tableParams=new r({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,r){t.getPagedResources(o(r)).$promise.then(function(t){r.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(r){t.deleteResource(r).$promise.then(function(){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,t,r){e.login=function(o){e.errorMessage="",r.login(o).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})["catch"](function(t){404==t.status&&(e.errorMessage=t.data),e.errorMessage=400===t.status?"Неверный Email/Пароль":"An error occured while performing this action. Please try after some time."})},e.register=function(o){return o.password!==o.confirmPassword?void(e.errorMessage="Пароли не совпадают"):(e.errorMessage="",void r.registerUser(o).$promise.then(function(){return r.login({Email:o.email,Password:o.password}).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})})["catch"](function(t){e.errorMessage=400===t.status?"Такой email уже существует.":"An error occured while performing this action. Please try after some time."}))},e.logOff=function(){r.logOffUser(),e.$emit("logOff"),t.url("/Login")}}]),app.controller("HomeCtrl",["$scope","resourceSvc",function(e,t){function r(){o()}function o(){e.resources=t.getTopFiveResources()}r()}]),utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,t){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},t.on("click",function(){angular.element("#"+e.id).modal("show")})}}}]),utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,r,o){t.datepicker({maxDate:0,onSelect:function(t){o.$setViewValue(t),e.$apply(),o.$setValidity("invalid",!1)}}),t.on("keypress",function(){return!1})}}}),utilities.directive("cstExternalUrl",function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(r,o,n){var c=n.cstExternalUrl;c&&t.test(c)&&(r.isWebUrl=!0,o.css("text-decoration","underline"),o.css("cursor","pointer")),o.on("click",function(){r.isWebUrl&&e.open(c)})}}}),app.directive("cstDelete",function(){return{replace:!0,link:function(e,t){console.log(t),t.on("click",function(){return confirm("Delete item?")})}}}),utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(e,t,r,o){function n(e){e.removeClass("hide"),e.addClass("show")}function c(e){e.removeClass("show"),e.addClass("hide")}var i=/\.html$|\.html\?/i,a={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(s,u){var l=[];r.request=function(e){return console.log("request: "+e.url),l.push({}),1==l.length&&n(u),e||t.when(e)},r.response=function(r){return i.test(r.config.url)&&(a[r.config.url]||(r.data=o.processTemplate(r),a[r.config.url]=!0)),console.log("response: "+r.config.url),l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),r||t.when(r)},r.responseError=function(r){return l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),t.reject(r)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(e,t){var r=/data-(keep|omit)/;return{processTemplate:function(o){var n=o.data,c=$("<div>").append(n);return r.test(n)&&c.find('[data-omit="'+t.role+'"]').each(function(){var e=$(this);e.remove()}),n=c.html(),e.put(o.config.url,n),n}}}]),utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(e,t,r){t.on("click",function(){var e="#"+r.cstModal;$(e).modal("show")})}}}),app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(e,t){var r=t.find("a");r.on("click",function(){r.removeClass("active"),$(this).addClass("active")}),e.$on("logOff",function(){e.isAuthenticated=!1}),e.$on("logOn",function(){e.isAuthenticated=!0})}}}),app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(e,t,r){return{responseError:function(o){switch(o.status){case 401:e.$broadcast("logOff"),r.url("/Login");break;case 403:r.url("/Login")}return t.reject(o)}}}]),app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}}),utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,t){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},t.on("click",function(){angular.element("#"+e.id).modal("show")})}}}]),utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,t,r,o){t.datepicker({maxDate:0,onSelect:function(t){o.$setViewValue(t),e.$apply(),o.$setValidity("invalid",!1)}}),t.on("keypress",function(){return!1})}}}),utilities.directive("cstExternalUrl",function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(r,o,n){var c=n.cstExternalUrl;c&&t.test(c)&&(r.isWebUrl=!0,o.css("text-decoration","underline"),o.css("cursor","pointer")),o.on("click",function(){r.isWebUrl&&e.open(c)})}}}),app.directive("cstDelete",function(){return{replace:!0,link:function(e,t){console.log(t),t.on("click",function(){return confirm("Delete item?")})}}}),utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(e,t,r,o){function n(e){e.removeClass("hide"),e.addClass("show")}function c(e){e.removeClass("show"),e.addClass("hide")}var i=/\.html$|\.html\?/i,a={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(s,u){var l=[];r.request=function(e){return console.log("request: "+e.url),l.push({}),1==l.length&&n(u),e||t.when(e)},r.response=function(r){return i.test(r.config.url)&&(a[r.config.url]||(r.data=o.processTemplate(r),a[r.config.url]=!0)),console.log("response: "+r.config.url),l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),r||t.when(r)},r.responseError=function(r){return l.pop(),0===l.length&&e(function(){0===l.length&&c(u)},500),t.reject(r)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(e,t){var r=/data-(keep|omit)/;return{processTemplate:function(o){var n=o.data,c=$("<div>").append(n);return r.test(n)&&c.find('[data-omit="'+t.role+'"]').each(function(){var e=$(this);e.remove()}),n=c.html(),e.put(o.config.url,n),n}}}]),utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(e,t,r){t.on("click",function(){var e="#"+r.cstModal;$(e).modal("show")})}}}),app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(e,t){var r=t.find("a");r.on("click",function(){r.removeClass("active"),$(this).addClass("active")}),e.$on("logOff",function(){e.isAuthenticated=!1}),e.$on("logOn",function(){e.isAuthenticated=!0})}}}),app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(e,t,r){e.deleteActivity=function(t){r.deleteActivity(t).then(function(){e.activities=r.getActivites(t.ResourceId)})}}]),app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(e,t,r,o){e.activity={ResourceId:r.resourceId},e.addActivity=function(e){o.addActivity(e).then(function(e){t.url("/Resources/"+e.ResourceId)})}}]),app.controller("CarModelCtrl",["$scope","$location","$routeParams","carModelService",function(e,t,r,o){function n(){r.carModelId>0&&(e.carModel=o.getById(r.carModelId))}e.addCarModel=function(e){o.add(e).$promise.then(function(){t.url("/CarModels")})},e.editCarModel=function(e){o.edit(e).$promise.then(function(){t.url("/CarModels")})},n()}]),app.controller("CarModelsCtrl",["$scope","ngTableParams","carModelService",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getAll().$promise.then(function(t){e.resolve(t)})}}),e.deleteCarModel=function(t){r["delete"](t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("HomeCtrl",["$scope","resourceSvc",function(e,t){function r(){o()}function o(){e.resources=t.getTopFiveResources()}r()}]),app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(e,t,r,o){function n(){r.locationId>0&&(e.location=o.getLocation(r.locationId))}e.addLocation=function(e){o.addLocation(e).$promise.then(function(){t.url("/Locations")})},e.editLocation=function(e){o.editLocation(e).$promise.then(function(){t.url("/Locations")})},n()}]),app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getLocations().$promise.then(function(t){e.resolve(t)})}}),e.deleteLocation=function(t){r.deleteLocation(t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("ManufactureCtrl",["$scope","$location","$routeParams","manufactureService",function(e,t,r,o){function n(){r.manufactureId>0&&(e.manufacture=o.getById(r.manufactureId))}e.addManufacture=function(e){o.add(e).$promise.then(function(){t.url("/Manufactures")})},e.editManufacture=function(e){o.edit(e).$promise.then(function(){t.url("/Manufactures")})},n()}]),app.controller("ManufacturesCtrl",["$scope","ngTableParams","manufactureService",function(e,t,r){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){r.getAll().$promise.then(function(t){e.resolve(t)})}}),e.deleteManufacture=function(t){r.deleteById(t).$promise.then(function(){e.tableParams.reload()})}}]),app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,t,r,o,n){function c(){t.resourceId>0?e.resource=o.getResource(t.resourceId):e.locations=n.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){o.addResource(e).$promise.then(function(){r.url("/Resources")})},c()}]),app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,t,r,o){function n(){for(var e=[],t=1;10>=t;t++)e.push({priority:t});return e}function c(){o.createResourceEditFormModel(r.resourceId).then(function(t){e.resource=t[0],e.locations=t[1],e.priorities=n()})}c(),e.editResource=function(e){o.editResource(e).$promise.then(function(){t.url("/Resources")})}}]),app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,t,r){var o=function(e){var t,r,o=e.sorting();if(o)for(var n in o){t=n,r=o[n];break}return{page:e.page(),count:e.count(),sortField:t,sortOrder:r}};e.tableParams=new r({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,r){t.getPagedResources(o(r)).$promise.then(function(t){r.total(t.TotalCount),e.resolve(t.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(r){t.deleteResource(r).$promise.then(function(){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]),app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(e,t,r){e.login=function(o){o.Email="admin@marlabs.com",o.Password="Marlabs",e.errorMessage="",r.login(o).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})["catch"](function(t){404==t.status&&(e.errorMessage=t.data),e.errorMessage=400===t.status?"Неверный Email/Пароль":"An error occured while performing this action. Please try after some time."})},e.register=function(o){return o.password!==o.confirmPassword?void(e.errorMessage="Пароли не совпадают"):(e.errorMessage="",void r.registerUser(o).$promise.then(function(){return r.login({Email:o.email,Password:o.password}).$promise.then(function(){e.$emit("logOn"),t.url("/Home")})})["catch"](function(t){e.errorMessage=400===t.status?"Такой email уже существует.":"An error occured while performing this action. Please try after some time."
}))},e.logOff=function(){r.logOffUser(),e.$emit("logOff"),t.url("/Login")}}]),app.service("activitySvc",["$resource","serviceHelperSvc",function(e,t){var r=t.ResourceActivity,o=function(e){return r.save({resourceId:e.ResourceId},e).$promise},n=function(e){return r["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},c=function(e){return r.query({resourceId:e})};return{addActivity:o,deleteActivity:n,getActivites:c}}]),app.factory("carModelService",["$resource","serviceHelperSvc",function(e,t){var r=t.CarModel,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({carModelId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({carModelId:e})};return{add:o,edit:n,getById:c,getAll:i,deleteById:a}}]),app.factory("locationSvc",["$resource","serviceHelperSvc",function(e,t){var r=t.Location,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({locationId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({locationId:e})};return{addLocation:o,editLocation:n,getLocation:c,getLocations:i,deleteLocation:a}}]),app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,t,r,o){var n=o.Resource,c=function(){return n.query({count:5})},i=function(){return n.query()},a=function(e){return n["delete"]({resourceId:e})},s=function(e){return n.save(e)},u=function(e){return n.update(e)},l=function(e){return n.get({resourceId:e})},d=function(e){var o=t.all([this.getResource(e).$promise,r.getLocations().$promise]);return o},p=function(e){return n.getPagedItems(e)};return{getTopFiveResources:c,getResources:i,deleteResource:a,addResource:s,editResource:u,getResource:l,createResourceEditFormModel:d,getPagedResources:p}}]),app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(e,t,r){var o=t.AuthorizationToken,n=t.Account,c=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t+=r+"="+e[r]+"&");return t.slice(0,t.length-1)};return{login:function(t){var n={username:t.Email,password:t.Password,grant_type:"password"};return o.requestToken(c(n),function(t){e.defaults.headers.common.Authorization="Bearer "+t.access_token,r.role=t.role})},registerUser:function(e){var t=n.register(e);return t},logOffUser:function(){e.defaults.headers.common.Authorization=null}}}]),app.factory("serviceHelperSvc",["$http","$resource",function(e,t){var r=config.apiurl,o=function(e){return r+e};return{AuthorizationToken:t(o("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:t(o("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Resource:t(o("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:o("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:t(o("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),Manufacture:t(o("api/Manufactures/:manufactureId"),{manufactureId:"@Id"},{update:{method:"PUT"}}),CarModel:t(o("api/CarModels/:carModelId"),{carModelId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:t(o("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]),app.factory("manufactureService",["$resource","serviceHelperSvc",function(e,t){var r=t.Manufacture,o=function(e){return r.save(e)},n=function(e){var t=r.update(e);return t},c=function(e){return r.get({manufactureId:e})},i=function(){return r.query()},a=function(e){return r["delete"]({manufactureId:e})};return{add:o,edit:n,getById:c,getAll:i,deleteById:a}}]);
app.factory("authorizationInterceptor",["$rootScope","$q","$location",function(r,o,t){return{responseError:function(e){switch(e.status){case 401:r.$broadcast("logOff"),t.url("/Login");break;case 403:t.url("/Login")}return o.reject(e)}}}]);
app.controller("ActivitiesCtrl",["$scope","$location","activitySvc",function(t,i,e){t.deleteActivity=function(i){e.deleteActivity(i).then(function(){t.activities=e.getActivites(i.ResourceId)})}}]);
app.controller("ActivityAddCtrl",["$scope","$location","$routeParams","activitySvc",function(t,c,i,o){t.activity={ResourceId:i.resourceId},t.addActivity=function(t){o.addActivity(t).then(function(t){c.url("/Resources/"+t.ResourceId)})}}]);
app.controller("CarModelCtrl",["$scope","$location","$routeParams","carModelService",function(o,e,r,d){function n(){r.carModelId>0&&(o.carModel=d.getById(r.carModelId))}o.addCarModel=function(o){d.add(o).$promise.then(function(){e.url("/CarModels")})},o.editCarModel=function(o){d.edit(o).$promise.then(function(){e.url("/CarModels")})},n()}]);
app.controller("CarModelsCtrl",["$scope","ngTableParams","carModelService",function(e,t,a){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){a.getAll().$promise.then(function(t){e.resolve(t)})}}),e.deleteCarModel=function(t){a["delete"](t).$promise.then(function(){e.tableParams.reload()})}}]);
app.controller("LocationCtrl",["$scope","$location","$routeParams","locationSvc",function(o,n,t,i){function c(){t.locationId>0&&(o.location=i.getLocation(t.locationId))}o.addLocation=function(o){i.addLocation(o).$promise.then(function(){n.url("/Locations")})},o.editLocation=function(o){i.editLocation(o).$promise.then(function(){n.url("/Locations")})},c()}]);
app.controller("LocationsCtrl",["$scope","ngTableParams","locationSvc",function(o,t,e){o.tableParams=new t({total:1,page:1},{counts:[],getData:function(o){e.getLocations().$promise.then(function(t){o.resolve(t)})}}),o.deleteLocation=function(t){e.deleteLocation(t).$promise.then(function(){o.tableParams.reload()})}}]);
app.controller("ManufactureCtrl",["$scope","$location","$routeParams","manufactureService",function(u,n,a,t){function e(){a.manufactureId>0&&(u.manufacture=t.getById(a.manufactureId))}u.addManufacture=function(u){t.add(u).$promise.then(function(){n.url("/Manufactures")})},u.editManufacture=function(u){t.edit(u).$promise.then(function(){n.url("/Manufactures")})},e()}]);
app.controller("ManufacturesCtrl",["$scope","ngTableParams","manufactureService",function(e,t,a){e.tableParams=new t({total:1,page:1},{counts:[],getData:function(e){a.getAll().$promise.then(function(t){e.resolve(t)})}}),e.deleteManufacture=function(t){a.deleteById(t).$promise.then(function(){e.tableParams.reload()})}}]);
app.directive("resourceActivityList",function(){return{restrict:"E",templateUrl:"/Scripts/app/directives/activities/ResourceActivityList.html",scope:{activities:"=activities"}}});
app.controller("ResourceCtrl",["$scope","$routeParams","$location","resourceSvc","locationSvc",function(e,o,c,r,s){function t(){o.resourceId>0?e.resource=r.getResource(o.resourceId):e.locations=s.getLocations()}e.resource={hasActivites:!1},e.addResource=function(e){r.addResource(e).$promise.then(function(){c.url("/Resources")})},t()}]);
app.controller("ResourceEditCtrl",["$scope","$location","$routeParams","resourceSvc",function(e,o,r,t){function c(){for(var e=[],o=1;10>=o;o++)e.push({priority:o});return e}function i(){t.createResourceEditFormModel(r.resourceId).then(function(o){e.resource=o[0],e.locations=o[1],e.priorities=c()})}i(),e.editResource=function(e){t.editResource(e).$promise.then(function(){o.url("/Resources")})}}]);
"use strict";app.controller("ResourcesCtrl",["$scope","resourceSvc","ngTableParams",function(e,a,t){var o=function(e){var a,t,o=e.sorting();if(o)for(var r in o){a=r,t=o[r];break}return{page:e.page(),count:e.count(),sortField:a,sortOrder:t}};e.tableParams=new t({page:1,count:10,sorting:{Name:"asc"}},{counts:[],total:0,getData:function(e,t){a.getPagedResources(o(t)).$promise.then(function(a){t.total(a.TotalCount),e.resolve(a.Data)})["catch"](function(e){console.log(e)})}}),e.deleteResource=function(t){a.deleteResource(t).$promise.then(function(){1!==e.tableParams.page()&&1===e.tableParams.data.length&&e.tableParams.page(1),e.tableParams.reload()})}}]);
"use strict";utilities.directive("cstConfirmModal",[function(){return{restrict:"A",scope:{approve:"&onApprove",deny:"&onDeny",closable:"=closable",id:"@modalId",title:"@title",message:"@message"},templateUrl:"/Scripts/app/partials/confirm-modal.html",link:function(e,l){e.closeModal=function(){angular.element("#"+e.id).modal("hide")},l.on("click",function(){angular.element("#"+e.id).modal("show")})}}}]);
utilities.directive("cstDatepicker",function(){return{restrict:"A",require:"ngModel",replace:!0,link:function(e,i,t,n){i.datepicker({maxDate:0,onSelect:function(i){n.$setViewValue(i),e.$apply(),n.$setValidity("invalid",!1)}});i.on("keypress",function(){return!1})}}});
"use strict";utilities.directive("cstExternalUrl",function(t){var r=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return{link:function(e,i,n){var s=n.cstExternalUrl;s&&r.test(s)&&(e.isWebUrl=!0,i.css("text-decoration","underline"),i.css("cursor","pointer")),i.on("click",function(){e.isWebUrl&&t.open(s)})}}});
app.directive("cstDelete",function(){return{replace:!0,link:function(e,n){console.log(n),n.on("click",function(){return confirm("Delete item?")})}}});
"use strict";utilities.directive("cstLoadingOverlay",["$timeout","$q","httpInterceptor","templateSvc",function(t,e,r,n){function o(t){t.removeClass("hide"),t.addClass("show")}function i(t){t.removeClass("show"),t.addClass("hide")}var s=/\.html$|\.html\?/i,l={};return{restrict:"E",templateUrl:"/Scripts/app/partials/Loader.html",link:function(c,u){var a=[];r.request=function(t){return console.log("request: "+t.url),a.push({}),1==a.length&&o(u),t||e.when(t)},r.response=function(r){return s.test(r.config.url)&&(l[r.config.url]||(r.data=n.processTemplate(r),l[r.config.url]=!0)),console.log("response: "+r.config.url),a.pop(),0===a.length&&t(function(){0===a.length&&i(u)},500),r||e.when(r)},r.responseError=function(r){return a.pop(),0===a.length&&t(function(){0===a.length&&i(u)},500),e.reject(r)}}}}]),utilities.factory("httpInterceptor",function(){return{}}),utilities.service("templateSvc",["$templateCache","userProfileSvc",function(t,e){var r=/data-(keep|omit)/;return{processTemplate:function(n){var o=n.data,i=$("<div>").append(o);return r.test(o)&&i.find('[data-omit="'+e.role+'"]').each(function(){var t=$(this);t.remove()}),o=i.html(),t.put(n.config.url,o),o}}}]);
utilities.directive("cstModal",function(){return{required:"ngModel",restrict:"A",link:function(i,t,n){t.on("click",function(){var i="#"+n.cstModal;$(i).modal("show")})}}});
app.directive("cstTopMenu",function(){return{restrict:"E",replace:!0,templateUrl:"/Scripts/app/partials/TopMenu.html",link:function(t,n){var i=n.find("a");i.on("click",function(){i.removeClass("active"),$(this).addClass("active")}),t.$on("logOff",function(){t.isAuthenticated=!1}),t.$on("logOn",function(){t.isAuthenticated=!0})}}});
app.controller("HomeCtrl",["$scope","resourceSvc",function(e,o){function c(){r()}function r(){e.resources=o.getTopFiveResources()}c()}]);
app.controller("ResourceMngrCtrl",["$scope","$location","resourceMngrSvc",function(r,e,o){r.login=function(s){s.Email="admin@marlabs.com",s.Password="Marlabs",r.errorMessage="",o.login(s).$promise.then(function(){r.$emit("logOn"),e.url("/Home")})["catch"](function(e){404==e.status&&(r.errorMessage=e.data),r.errorMessage=400===e.status?"Неверный Email/Пароль":"An error occured while performing this action. Please try after some time."})},r.register=function(s){return s.password!==s.confirmPassword?void(r.errorMessage="Пароли не совпадают"):(r.errorMessage="",void o.registerUser(s).$promise.then(function(){return o.login({Email:s.email,Password:s.password}).$promise.then(function(){r.$emit("logOn"),e.url("/Home")})})["catch"](function(e){r.errorMessage=400===e.status?"Такой email уже существует.":"An error occured while performing this action. Please try after some time."}))},r.logOff=function(){o.logOffUser(),r.$emit("logOff"),e.url("/Login")}}]);
app.factory("carModelService",["$resource","serviceHelperSvc",function(e,r){var t=r.CarModel,n=function(e){return t.save(e)},u=function(e){var r=t.update(e);return r},c=function(e){return t.get({carModelId:e})},d=function(){return t.query()},o=function(e){return t["delete"]({carModelId:e})};return{add:n,edit:u,getById:c,getAll:d,deleteById:o}}]);
app.factory("locationSvc",["$resource","serviceHelperSvc",function(t,n){var o=n.Location,e=function(t){return o.save(t)},c=function(t){var n=o.update(t);return n},r=function(t){return o.get({locationId:t})},i=function(){return o.query()},a=function(t){return o["delete"]({locationId:t})};return{addLocation:e,editLocation:c,getLocation:r,getLocations:i,deleteLocation:a}}]);
app.factory("manufactureService",["$resource","serviceHelperSvc",function(e,r){var t=r.Manufacture,u=function(e){return t.save(e)},n=function(e){var r=t.update(e);return r},a=function(e){return t.get({manufactureId:e})},c=function(){return t.query()},f=function(e){return t["delete"]({manufactureId:e})};return{add:u,edit:n,getById:a,getAll:c,deleteById:f}}]);
app.service("activitySvc",["$resource","serviceHelperSvc",function(e,r){var t=r.ResourceActivity,c=function(e){return t.save({resourceId:e.ResourceId},e).$promise},i=function(e){return t["delete"]({resourceId:e.ResourceId,activityId:e.Id}).$promise},u=function(e){return t.query({resourceId:e})};return{addActivity:c,deleteActivity:i,getActivites:u}}]);
app.factory("resourceSvc",["$resource","$q","locationSvc","serviceHelperSvc",function(e,r,t,u){var o=u.Resource,c=function(){return o.query({count:5})},n=function(){return o.query()},s=function(e){return o["delete"]({resourceId:e})},i=function(e){return o.save(e)},a=function(e){return o.update(e)},d=function(e){return o.get({resourceId:e})},f=function(e){var u=r.all([this.getResource(e).$promise,t.getLocations().$promise]);return u},g=function(e){return o.getPagedItems(e)};return{getTopFiveResources:c,getResources:n,deleteResource:s,addResource:i,editResource:a,getResource:d,createResourceEditFormModel:f,getPagedResources:g}}]);
app.factory("resourceMngrSvc",["$http","serviceHelperSvc","userProfileSvc",function(r,e,n){var o=e.AuthorizationToken,t=e.Account,a=function(r){var e="";for(var n in r)r.hasOwnProperty(n)&&(e+=n+"="+r[n]+"&");return e.slice(0,e.length-1)};return{login:function(e){var t={username:e.Email,password:e.Password,grant_type:"password"};return o.requestToken(a(t),function(e){r.defaults.headers.common.Authorization="Bearer "+e.access_token,n.role=e.role})},registerUser:function(r){var e=t.register(r);return e},logOffUser:function(){r.defaults.headers.common.Authorization=null}}}]);
app.factory("serviceHelperSvc",["$http","$resource",function(e,o){var t=config.apiurl,r=function(e){return t+e};return{AuthorizationToken:o(r("Token"),null,{requestToken:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}}),Account:o(r("api/Account/"),null,{register:{method:"post"},logOff:{method:"put"}}),Resource:o(r("api/Resources/:resourceId"),{resourceId:"@Id"},{update:{method:"PUT"},getPagedItems:{url:r("api/Resources?count=:count&page=:page&sortField=:sortField&sortOrder=:sortOrder"),method:"GET",params:{count:"@count",page:"@page",sortField:"@sortField",sortOrder:"@sortOrder"}}}),Location:o(r("api/Locations/:locationId"),{locationId:"@Id"},{update:{method:"PUT"}}),Manufacture:o(r("api/Manufactures/:manufactureId"),{manufactureId:"@Id"},{update:{method:"PUT"}}),CarModel:o(r("api/CarModels/:carModelId"),{carModelId:"@Id"},{update:{method:"PUT"}}),ResourceActivity:o(r("api/Resources/:resourceId/Activities/:activityId"),{resourceId:"@ResourceId",activityId:"@Id"})}}]);